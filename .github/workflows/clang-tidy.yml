# Action name
name: Clang Tidy

# Here, this action will be enabled on all pushes.
# Modify this to fit your needs.
on:
    push

# Jobs section
jobs:
    # The job that will use the container image you just pushed to ghcr.io
    clang-tidy-job:
        runs-on: ubuntu-20.04
        container:
            image: ghcr.io/drlk/clang-tidy-image:v16
            credentials:
               username: drlk
               password: ${{  secrets.DOCKER_CONTAINER_REGISTRY_TOKEN }}
        steps:
            - uses: actions/checkout@v2
            - name: clang-tidy
              shell: bash
              run: |
                cmake --version
                cd ./SimpleNetworkProtocol/build
                cmake -DCMAKE_EXPORT_COMPILE_COMMANDS=1 ..
                clang-tidy --version
                cd ../src
                clang-tidy -p ../build -checks='*, -modernize-use-trailing-return-type,-llvmlibc-*,-llvm-header-guard,-altera-unroll-loops,-fuchsia-default-arguments-calls,-cppcoreguidelines-avoid-magic-numbers,-readability-magic-numbers,-performance-move-const-arg,-hicpp-move-const-arg,-misc-definitions-in-headers,-altera-id-dependent-backward-branch,-readability-convert-member-functions-to-static,-bugprone-easily-swappable-parameters,-google-readability-todo' -warnings-as-errors='*' ./*pp

